<div align="center">

#### [목차 바로가기](https://github.com/dhslrl321/cqrs-journey-korean-ver/blob/master/Table%20of%20Contents.mdwn)

</div>

---

# 레거시 시스템과 통합하기

CQRS 패턴을 이용하는 바운디드 컨텍스트에는 이미 이벤트를 게시하고 수신하는데 필요한 인프라가 많이 존재한다.

하지만 레거시 시스템을 포함하는 바운디드 컨텍스트는 그렇지 않을 수 있다.

레거시가 포함된 바운디드 컨텍스트로 구현하는 방법은 주로 레거시 시스템을 수정할 수 있는지 여부에 달려있다.

고정 인터페이스가 블랙박스일 수도 있고 소스 코드에 액세스 할 수도 있고 이벤트와 함께 작동하도록 수정할 수 있다.

다음 섹션에서는 레거시 시스템에 대해서 CQRS 패턴을 구현하는 바운디드 컨텍스트로 데이터를 가져오는 몇가지 일반적인 접근법을 설명한다.

## Reading Database

많은 레거시 시스템은 RDB 를 사용하여 데이터를 저장한다. 레거시 시스템에서 CQRS 패턴을 구현하는 바운디드 컨텍스트로 데이터를 가져오는 간단한 방법은 바운디드 컨텍스트가 DB에서 직접 필요한 데이터를 가져오도록 하는 것이다.

이 접근 방식은 레거시 시스템에서 사용할 수 있는 API 가 없거나 레거시 시스템을 변경할 수 없는 경우에 유용하다.

그러나 이 방법은 해당 바운디드 컨텍스트가 레거시 시스템에 단단히 결합되어있는 방법이다.

## Generating Events from the Database

대안으로, 레거시 시스템에서 DB 를 모니터링하는 메커니즘을 구현하고 변경 사항에 대해 이벤트를 발행하는 것이다.

이 접근법은 두 개의 바운디드 컨텍스트를 분리하며 데이터베이스를 모니터링하기 위한 추가 프로세스를 만들고 있기 때문에 기존 레거시 코드를 변경하지 않고도 채택할 수 있는 방법이다.

하지만 레거시 시스템과 결합된 또 다른 프로그램이 관리 포인트가 된다.

## Modifying the legacy system

레거시 시스템을 수정할 수 있다면, 이벤트를 발행할 수 있도록 수정하는 것이다.

이 접근법을 사용한다면 여전히 잠재적인 consistency 문제가 있다.

레거시 시스템이 항상 트랜잭션을 보장하는지에 대한 것이다.

consistency 를 보장하기 위해서는 분산 트랜잭션을 사용하거나 두 작업이 성공적으로 완료됨을 보장하는 다른 메커니즘을 도입해야 한다.

## Implications for event sourcing

CQRS 패턴을 구현하는 바운디드 컨텍스트가 이벤트 소싱을 사용하는 경우, 해당 도메인의 애그리거트에 의해 게시된 모든 이벤트는 이벤트 스토어로 저장된다.

이벤트를 발행하도록 레거시를 수정했다면, 이러한 이벤트도 함께 저장하는지 고려해야한다.

예를 들어서 이러한 이벤트를 사용해서 read model 도 만들 수 있다. read model 을 재구축하려면 모든 이벤트의 복사본이 필요하다

> 실용적인 솔루션으로, 레거시 바운디드 컨텍스트가 CQRS 바운디드 컨텍스트가 사용하는 이벤트 저장소에 직접 이벤트를 저장하는 것을 허용하는 것을 고려할 수도 있습니다.

---
